<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>🎰 Whacky Blackjack Bonanza! 🎰</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee&family=Creepster&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Bungee', cursive;
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5, #ffbe0b, #fb5607);
            background-size: 600% 600%;
            animation: crazyGradient 15s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            padding: 10px;
        }
        
        @keyframes crazyGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes bodyShake {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-10px); }
            20% { transform: translateX(10px); }
            30% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            50% { transform: translateX(-10px); }
            60% { transform: translateX(10px); }
            70% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
            90% { transform: translateX(-10px); }
        }
        
        .game-container {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.5);
            animation: pulse 2s ease-in-out infinite;
            max-width: 800px;
            width: 90%;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        h1 {
            text-align: center;
            color: #ffbe0b;
            font-size: clamp(1.5em, 5vw, 3em);
            margin-bottom: 20px;
            text-shadow: 3px 3px 0px #ff006e, 6px 6px 0px #8338ec;
            animation: wobble 3s ease-in-out infinite;
        }
        
        @keyframes wobble {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        
        .card-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin: 10px 0;
            min-height: 180px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .card-area h2 {
            margin: 0 0 10px 0;
        }
        
        .cards-container {
            min-height: 130px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .card-area::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #06ffa5);
            border-radius: 20px;
            animation: borderRotate 3s linear infinite;
            z-index: -1;
        }
        
        @keyframes borderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .card {
            display: inline-block;
            width: clamp(60px, 12vw, 80px);
            height: clamp(90px, 18vw, 120px);
            background: white;
            border-radius: 10px;
            margin: 3px;
            text-align: center;
            line-height: clamp(90px, 18vw, 120px);
            font-size: clamp(1.5em, 3vw, 2em);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            animation: cardDrop 0.5s ease-out;
            position: relative;
            cursor: pointer;
        }
        
        @keyframes cardDrop {
            0% {
                transform: translateY(-200px) rotate(720deg);
                opacity: 0;
            }
            100% {
                transform: translateY(0) rotate(0);
                opacity: 1;
            }
        }
        
        .card:hover {
            transform: translateY(-10px) rotate(5deg) scale(1.1);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
        }
        
        .card.red {
            color: #ff006e;
        }
        
        .card.black {
            color: #000;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        button {
            font-family: 'Bungee', cursive;
            font-size: clamp(0.9em, 2.5vw, 1.2em);
            padding: clamp(12px, 3vw, 15px) clamp(20px, 5vw, 30px);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .hit-btn {
            background: linear-gradient(45deg, #ff006e, #fb5607);
            color: white;
            animation: buttonShake 2s ease-in-out infinite;
        }
        
        @keyframes buttonShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .stand-btn {
            background: linear-gradient(45deg, #3a86ff, #8338ec);
            color: white;
        }
        
        .new-game-btn {
            background: linear-gradient(45deg, #06ffa5, #ffbe0b);
            color: black;
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .score-display {
            font-size: 1.5em;
            color: #06ffa5;
            text-shadow: 2px 2px 0px #000;
            margin: 10px 0;
        }
        
        .message {
            text-align: center;
            font-size: 2em;
            margin: 20px 0;
            min-height: 50px;
            animation: flash 1s ease-in-out infinite;
        }
        
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .message.win {
            color: #06ffa5;
            text-shadow: 3px 3px 0px #000;
        }
        
        .message.lose {
            color: #ff006e;
            text-shadow: 3px 3px 0px #000;
        }
        
        .message.push {
            color: #ffbe0b;
            text-shadow: 3px 3px 0px #000;
        }
        
        .special-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff006e;
            animation: confettiFall 3s linear;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .emoji-explosion {
            position: absolute;
            font-size: 3em;
            animation: explode 1s ease-out;
        }
        
        @keyframes explode {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: scale(3) rotate(360deg);
                opacity: 0;
            }
        }
        
        .power-up {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff006e, #ffbe0b);
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            font-size: clamp(0.9em, 2.5vw, 1.2em);
            animation: powerUpPulse 1s ease-in-out infinite;
            cursor: pointer;
            z-index: 100;
            -webkit-tap-highlight-color: transparent;
        }
        
        @keyframes powerUpPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 190, 11, 0.5); }
            50% { transform: scale(1.1); box-shadow: 0 0 40px rgba(255, 190, 11, 0.8); }
        }
        
        .hidden {
            display: none;
        }
        
        .scoreboard {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #ffbe0b;
            border-radius: 20px;
            padding: 15px;
            color: white;
            min-width: 150px;
            box-shadow: 0 0 30px rgba(255, 190, 11, 0.5);
            animation: scoreboardGlow 2s ease-in-out infinite;
            z-index: 100;
            font-size: clamp(0.8em, 2vw, 1em);
            transition: transform 0.3s ease, opacity 0.3s ease;
            transform-origin: top left;
        }
        
        .scoreboard.hidden {
            transform: translateX(-120%) scale(0.8);
            opacity: 0;
            pointer-events: none;
        }
        
        .score-toggle {
            position: fixed;
            top: 10px;
            left: 10px;
            background: linear-gradient(45deg, #ffbe0b, #ff006e);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 101;
            box-shadow: 0 0 20px rgba(255, 190, 11, 0.5);
            animation: togglePulse 2s ease-in-out infinite;
            transition: transform 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .score-toggle:hover {
            transform: scale(1.1);
        }
        
        .score-toggle:active {
            transform: scale(0.95);
        }
        
        @keyframes togglePulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 190, 11, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 190, 11, 0.8); }
        }
        
        @keyframes scoreboardGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 190, 11, 0.5); }
            50% { box-shadow: 0 0 50px rgba(255, 190, 11, 0.8); }
        }
        
        .scoreboard h3 {
            color: #ffbe0b;
            margin-bottom: 15px;
            font-size: 1.5em;
            text-align: center;
            text-shadow: 2px 2px 0px #000;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 1.1em;
        }
        
        .score-item span:first-child {
            color: #06ffa5;
        }
        
        .score-item span:last-child {
            color: #fff;
            font-weight: bold;
        }
        
        .streak {
            color: #ff006e !important;
            animation: streakPulse 1s ease-in-out infinite;
        }
        
        @keyframes streakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
                width: 95%;
                max-width: none;
            }
            
            .card-area {
                padding: 15px;
                min-height: 160px;
            }
            
            .cards-container {
                min-height: 110px;
            }
            
            .buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            button {
                flex: 1;
                min-width: 120px;
            }
            
            .message {
                font-size: clamp(1.2em, 4vw, 2em);
            }
            
            .scoreboard {
                transform: scale(0.9);
                transform-origin: top left;
            }
            
            .scoreboard h3 {
                font-size: 1.2em;
            }
            
            .score-display {
                font-size: clamp(1em, 3vw, 1.5em);
            }
            
            .card:hover {
                transform: none;
            }
            
            button:active {
                transform: scale(0.95);
            }
        }
        
        @media (max-width: 480px) {
            .scoreboard {
                position: fixed;
                top: 70px;
                left: 10px;
                right: 10px;
                width: auto;
            }
            
            .scoreboard.hidden {
                transform: translateY(-120%) scale(0.8);
                opacity: 0;
            }
            
            .power-up {
                position: relative;
                margin-bottom: 10px;
                width: 100%;
                text-align: center;
            }
            
            .score-toggle {
                width: 45px;
                height: 45px;
                font-size: 1.3em;
            }
        }
        
        .sound-toggle {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: linear-gradient(45deg, #3a86ff, #06ffa5);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 101;
            box-shadow: 0 0 20px rgba(58, 134, 255, 0.5);
            animation: soundPulse 2s ease-in-out infinite;
            transition: transform 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
        }
        
        .sound-toggle:active {
            transform: scale(0.95);
        }
        
        .sound-toggle.muted {
            background: linear-gradient(45deg, #666, #999);
            animation: none;
        }
        
        @keyframes soundPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(58, 134, 255, 0.5); }
            50% { box-shadow: 0 0 40px rgba(58, 134, 255, 0.8); }
        }
    </style>
</head>
<body>
    <div class="special-effects" id="effects"></div>
    
    <button class="score-toggle" onclick="toggleScoreboard()">📊</button>
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">🔊</button>
    
    <div class="game-container">
        <div class="scoreboard hidden" id="scoreboard">
            <h3>📊 SCOREBOARD 📊</h3>
            <div class="score-item">
                <span>Wins:</span>
                <span id="wins">0</span>
            </div>
            <div class="score-item">
                <span>Losses:</span>
                <span id="losses">0</span>
            </div>
            <div class="score-item">
                <span>Pushes:</span>
                <span id="pushes">0</span>
            </div>
            <div class="score-item">
                <span>Win %:</span>
                <span id="winRate">0%</span>
            </div>
            <div class="score-item streak">
                <span>🔥 Streak:</span>
                <span id="streak">0</span>
            </div>
            <div class="score-item">
                <span>Best Streak:</span>
                <span id="bestStreak">0</span>
            </div>
        </div>
        
        <div class="power-up hidden" id="powerUp" onclick="activatePowerUp()">
            ⚡ POWER UP! ⚡
        </div>
        
        <h1>🎰 WHACKY BLACKJACK 🎰</h1>
        
        <div class="card-area">
            <h2 style="color: #8338ec;">Dealer's Hand</h2>
            <div class="cards-container" id="dealerCards"></div>
            <div class="score-display">Score: <span id="dealerScore">0</span></div>
        </div>
        
        <div class="card-area">
            <h2 style="color: #3a86ff;">Your Hand</h2>
            <div class="cards-container" id="playerCards"></div>
            <div class="score-display">Score: <span id="playerScore">0</span></div>
        </div>
        
        <div class="message" id="message"></div>
        
        <div class="buttons">
            <button class="hit-btn" onclick="hit()" id="hitBtn">HIT ME! 🎯</button>
            <button class="stand-btn" onclick="stand()" id="standBtn">STAND 🛑</button>
            <button class="new-game-btn" onclick="newGame()">NEW GAME 🎮</button>
        </div>
    </div>
    
    <script>
        const suits = ['♠', '♥', '♦', '♣'];
        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        const emojis = ['🎉', '🎊', '🌟', '💥', '🚀', '🎯', '🔥', '⚡', '🌈', '✨'];
        
        let deck = [];
        let playerHand = [];
        let dealerHand = [];
        let gameOver = false;
        let powerUpActive = false;
        let powerUpCount = 0;
        
        let scores = {
            wins: parseInt(localStorage.getItem('blackjack_wins') || 0),
            losses: parseInt(localStorage.getItem('blackjack_losses') || 0),
            pushes: parseInt(localStorage.getItem('blackjack_pushes') || 0),
            currentStreak: parseInt(localStorage.getItem('blackjack_streak') || 0),
            bestStreak: parseInt(localStorage.getItem('blackjack_best_streak') || 0)
        };
        
        let scoreboardVisible = false;
        let soundEnabled = true;
        let musicInterval = null;
        
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        const sounds = {
            bgMusic: null,
            bgMusicNodes: [],
            cardDeal: null,
            win: null,
            lose: null,
            button: null,
            powerUp: null
        };
        
        function createCircusMusic() {
            const nodes = [];
            
            const mainOsc = audioContext.createOscillator();
            const mainGain = audioContext.createGain();
            const mainFilter = audioContext.createBiquadFilter();
            mainOsc.type = 'square';
            mainFilter.type = 'lowpass';
            mainFilter.frequency.value = 1000;
            mainGain.gain.value = 0.03;
            mainOsc.connect(mainFilter);
            mainFilter.connect(mainGain);
            mainGain.connect(audioContext.destination);
            
            const bassOsc = audioContext.createOscillator();
            const bassGain = audioContext.createGain();
            bassOsc.type = 'sawtooth';
            bassGain.gain.value = 0.02;
            bassOsc.connect(bassGain);
            bassGain.connect(audioContext.destination);
            
            const notes = [261.63, 329.63, 392.00, 329.63, 261.63, 261.63, 329.63, 392.00, 523.25, 392.00, 
                          440.00, 392.00, 349.23, 329.63, 293.66, 261.63, 293.66, 329.63, 349.23, 392.00];
            const bassNotes = [130.81, 130.81, 196.00, 196.00, 130.81, 130.81, 196.00, 196.00];
            let noteIndex = 0;
            let bassIndex = 0;
            let beatCount = 0;
            
            function playNextNote() {
                if (soundEnabled) {
                    mainOsc.frequency.setValueAtTime(notes[noteIndex], audioContext.currentTime);
                    noteIndex = (noteIndex + 1) % notes.length;
                    
                    if (beatCount % 2 === 0) {
                        bassOsc.frequency.setValueAtTime(bassNotes[bassIndex], audioContext.currentTime);
                        bassIndex = (bassIndex + 1) % bassNotes.length;
                    }
                    
                    if (beatCount % 8 === 0) {
                        const cymbal = audioContext.createOscillator();
                        const cymbalGain = audioContext.createGain();
                        const cymbalFilter = audioContext.createBiquadFilter();
                        cymbal.type = 'triangle';
                        cymbalFilter.type = 'highpass';
                        cymbalFilter.frequency.value = 5000;
                        cymbal.frequency.value = 8000 + Math.random() * 4000;
                        cymbalGain.gain.setValueAtTime(0.05, audioContext.currentTime);
                        cymbalGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                        cymbal.connect(cymbalFilter);
                        cymbalFilter.connect(cymbalGain);
                        cymbalGain.connect(audioContext.destination);
                        cymbal.start();
                        cymbal.stop(audioContext.currentTime + 0.1);
                    }
                    
                    beatCount++;
                }
            }
            
            mainOsc.start();
            bassOsc.start();
            musicInterval = setInterval(playNextNote, 200);
            
            sounds.bgMusicNodes = [mainOsc, bassOsc, mainGain, bassGain];
            
            return { oscillator: mainOsc, gain: mainGain, bass: bassOsc, bassGain: bassGain };
        }
        
        function playSound(type, frequency = 440, duration = 0.1) {
            if (!soundEnabled) return;
            
            switch(type) {
                case 'cardDeal':
                    const whipOsc = audioContext.createOscillator();
                    const whipGain = audioContext.createGain();
                    const whipFilter = audioContext.createBiquadFilter();
                    whipOsc.type = 'sawtooth';
                    whipFilter.type = 'bandpass';
                    whipFilter.frequency.value = 1000;
                    whipFilter.Q.value = 5;
                    whipOsc.frequency.setValueAtTime(2000, audioContext.currentTime);
                    whipOsc.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.15);
                    whipGain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    whipGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    whipOsc.connect(whipFilter);
                    whipFilter.connect(whipGain);
                    whipGain.connect(audioContext.destination);
                    whipOsc.start();
                    whipOsc.stop(audioContext.currentTime + 0.15);
                    break;
                    
                case 'win':
                    for (let i = 0; i < 8; i++) {
                        setTimeout(() => {
                            const winOsc = audioContext.createOscillator();
                            const winGain = audioContext.createGain();
                            winOsc.type = i % 2 === 0 ? 'square' : 'triangle';
                            winOsc.frequency.value = 300 + (i * 100) + Math.random() * 50;
                            winGain.gain.setValueAtTime(0.2, audioContext.currentTime);
                            winGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                            winOsc.connect(winGain);
                            winGain.connect(audioContext.destination);
                            winOsc.start();
                            winOsc.stop(audioContext.currentTime + 0.3);
                        }, i * 60);
                    }
                    
                    const hornOsc = audioContext.createOscillator();
                    const hornGain = audioContext.createGain();
                    hornOsc.type = 'square';
                    hornOsc.frequency.setValueAtTime(220, audioContext.currentTime);
                    hornOsc.frequency.setValueAtTime(440, audioContext.currentTime + 0.1);
                    hornOsc.frequency.setValueAtTime(220, audioContext.currentTime + 0.2);
                    hornGain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    hornOsc.connect(hornGain);
                    hornGain.connect(audioContext.destination);
                    hornOsc.start();
                    hornOsc.stop(audioContext.currentTime + 0.5);
                    break;
                    
                case 'lose':
                    const slideOsc = audioContext.createOscillator();
                    const slideGain = audioContext.createGain();
                    const slideFilter = audioContext.createBiquadFilter();
                    slideOsc.type = 'sawtooth';
                    slideFilter.type = 'lowpass';
                    slideFilter.frequency.value = 500;
                    slideOsc.frequency.setValueAtTime(400, audioContext.currentTime);
                    slideOsc.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.5);
                    slideGain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    
                    for (let i = 0; i < 4; i++) {
                        slideOsc.frequency.setValueAtTime(300 - i * 50, audioContext.currentTime + i * 0.1);
                    }
                    
                    slideOsc.connect(slideFilter);
                    slideFilter.connect(slideGain);
                    slideGain.connect(audioContext.destination);
                    slideOsc.start();
                    slideOsc.stop(audioContext.currentTime + 0.5);
                    
                    setTimeout(() => {
                        const womp = audioContext.createOscillator();
                        const wompGain = audioContext.createGain();
                        womp.type = 'triangle';
                        womp.frequency.value = 55;
                        wompGain.gain.setValueAtTime(0.4, audioContext.currentTime);
                        wompGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        womp.connect(wompGain);
                        wompGain.connect(audioContext.destination);
                        womp.start();
                        womp.stop(audioContext.currentTime + 0.2);
                    }, 300);
                    break;
                    
                case 'button':
                    const boing = audioContext.createOscillator();
                    const boingGain = audioContext.createGain();
                    const boingFilter = audioContext.createBiquadFilter();
                    boing.type = 'sine';
                    boingFilter.type = 'bandpass';
                    boingFilter.frequency.value = 800;
                    boingFilter.Q.value = 10;
                    boing.frequency.setValueAtTime(200, audioContext.currentTime);
                    boing.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.05);
                    boing.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                    boingGain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    boingGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    boing.connect(boingFilter);
                    boingFilter.connect(boingGain);
                    boingGain.connect(audioContext.destination);
                    boing.start();
                    boing.stop(audioContext.currentTime + 0.1);
                    break;
                    
                case 'powerUp':
                    for (let i = 0; i < 15; i++) {
                        setTimeout(() => {
                            const sparkle = audioContext.createOscillator();
                            const sparkleGain = audioContext.createGain();
                            sparkle.type = 'sine';
                            sparkle.frequency.value = 800 + Math.random() * 2000;
                            sparkleGain.gain.setValueAtTime(0.1, audioContext.currentTime);
                            sparkleGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                            sparkle.connect(sparkleGain);
                            sparkleGain.connect(audioContext.destination);
                            sparkle.start();
                            sparkle.stop(audioContext.currentTime + 0.1);
                        }, i * 30);
                    }
                    
                    const sweep = audioContext.createOscillator();
                    const sweepGain = audioContext.createGain();
                    sweep.type = 'triangle';
                    sweep.frequency.setValueAtTime(100, audioContext.currentTime);
                    sweep.frequency.exponentialRampToValueAtTime(2000, audioContext.currentTime + 0.4);
                    sweepGain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    sweep.connect(sweepGain);
                    sweepGain.connect(audioContext.destination);
                    sweep.start();
                    sweep.stop(audioContext.currentTime + 0.4);
                    break;
            }
        }
        
        function createDeck() {
            deck = [];
            for (let suit of suits) {
                for (let value of values) {
                    deck.push({ suit, value });
                }
            }
            deck.push({ suit: '🃏', value: 'W' });
            deck.push({ suit: '🎰', value: 'L' });
        }
        
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        function getCardValue(card) {
            if (card.value === 'A') return 11;
            if (['J', 'Q', 'K'].includes(card.value)) return 10;
            if (card.value === 'W') return Math.floor(Math.random() * 11) + 1;
            if (card.value === 'L') return 7;
            return parseInt(card.value);
        }
        
        function calculateScore(hand) {
            let score = 0;
            let aces = 0;
            
            for (let card of hand) {
                if (card.value === 'A') aces++;
                score += getCardValue(card);
            }
            
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            
            return score;
        }
        
        function renderCard(card, isHidden = false) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            
            if (isHidden) {
                cardDiv.textContent = '?';
                cardDiv.style.background = 'linear-gradient(45deg, #8338ec, #3a86ff)';
                cardDiv.style.color = 'white';
            } else {
                if (card.suit === '🃏') {
                    cardDiv.textContent = '🃏';
                    cardDiv.style.background = 'linear-gradient(45deg, gold, orange)';
                } else if (card.suit === '🎰') {
                    cardDiv.textContent = '🎰';
                    cardDiv.style.background = 'linear-gradient(45deg, lime, green)';
                } else {
                    cardDiv.textContent = card.value + card.suit;
                    if (card.suit === '♥' || card.suit === '♦') {
                        cardDiv.classList.add('red');
                    } else {
                        cardDiv.classList.add('black');
                    }
                }
            }
            
            const handleCardInteraction = (e) => {
                if (!gameOver && !isHidden) {
                    e.preventDefault();
                    const rect = cardDiv.getBoundingClientRect();
                    createEmoji(rect.left + rect.width/2, rect.top + rect.height/2);
                    cardDiv.style.animation = 'none';
                    setTimeout(() => {
                        cardDiv.style.animation = 'cardDrop 0.5s ease-out';
                    }, 10);
                    playSound('button');
                }
            };
            
            cardDiv.onclick = handleCardInteraction;
            cardDiv.ontouchstart = handleCardInteraction;
            
            return cardDiv;
        }
        
        function renderHands() {
            const playerCardsDiv = document.getElementById('playerCards');
            const dealerCardsDiv = document.getElementById('dealerCards');
            
            playerCardsDiv.innerHTML = '';
            dealerCardsDiv.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                setTimeout(() => {
                    playerCardsDiv.appendChild(renderCard(card));
                    playSound('cardDeal');
                }, index * 100);
            });
            
            dealerHand.forEach((card, index) => {
                setTimeout(() => {
                    if (index === 0 && !gameOver) {
                        dealerCardsDiv.appendChild(renderCard(card, true));
                    } else {
                        dealerCardsDiv.appendChild(renderCard(card));
                    }
                    playSound('cardDeal');
                }, (index + playerHand.length) * 100);
            });
            
            updateScores();
        }
        
        function updateScores() {
            const playerScore = calculateScore(playerHand);
            const dealerScore = calculateScore(dealerHand);
            
            document.getElementById('playerScore').textContent = playerScore;
            
            if (gameOver) {
                document.getElementById('dealerScore').textContent = dealerScore;
            } else {
                const visibleDealerScore = getCardValue(dealerHand[1]);
                document.getElementById('dealerScore').textContent = visibleDealerScore + '+?';
            }
        }
        
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = confetti.style.width;
                    document.getElementById('effects').appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }
        
        function createEmoji(x, y) {
            const emoji = document.createElement('div');
            emoji.className = 'emoji-explosion';
            emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            emoji.style.left = x + 'px';
            emoji.style.top = y + 'px';
            document.getElementById('effects').appendChild(emoji);
            
            setTimeout(() => emoji.remove(), 1000);
        }
        
        function showPowerUpMessage(msg) {
            const msgDiv = document.createElement('div');
            msgDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #ff006e, #ffbe0b);
                color: white;
                padding: 20px 40px;
                border-radius: 30px;
                font-size: 1.5em;
                font-weight: bold;
                z-index: 2000;
                animation: powerUpMessage 2s ease-out;
                text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
            `;
            msgDiv.textContent = msg;
            document.body.appendChild(msgDiv);
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes powerUpMessage {
                    0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1.2) rotate(5deg); opacity: 1; }
                    100% { transform: translate(-50%, -150%) scale(0.8) rotate(-5deg); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                msgDiv.remove();
                style.remove();
            }, 2000);
        }
        
        function hit() {
            if (gameOver) return;
            
            playSound('button');
            playerHand.push(deck.pop());
            renderHands();
            
            const playerScore = calculateScore(playerHand);
            
            if (playerScore > 21) {
                endGame();
            } else if (playerScore === 21) {
                document.getElementById('message').textContent = '🎯 BLACKJACK! 🎯';
                createConfetti();
                playSound('win');
            }
            
            if (Math.random() < 0.1 && !powerUpActive) {
                document.getElementById('powerUp').classList.remove('hidden');
                powerUpCount++;
            }
        }
        
        function stand() {
            if (gameOver) return;
            
            playSound('button');
            gameOver = true;
            
            while (calculateScore(dealerHand) < 17) {
                dealerHand.push(deck.pop());
            }
            
            endGame();
        }
        
        function updateScoreboard() {
            document.getElementById('wins').textContent = scores.wins;
            document.getElementById('losses').textContent = scores.losses;
            document.getElementById('pushes').textContent = scores.pushes;
            document.getElementById('streak').textContent = scores.currentStreak;
            document.getElementById('bestStreak').textContent = scores.bestStreak;
            
            const totalGames = scores.wins + scores.losses;
            const winRate = totalGames > 0 ? Math.round((scores.wins / totalGames) * 100) : 0;
            document.getElementById('winRate').textContent = winRate + '%';
            
            localStorage.setItem('blackjack_wins', scores.wins);
            localStorage.setItem('blackjack_losses', scores.losses);
            localStorage.setItem('blackjack_pushes', scores.pushes);
            localStorage.setItem('blackjack_streak', scores.currentStreak);
            localStorage.setItem('blackjack_best_streak', scores.bestStreak);
        }
        
        function endGame() {
            gameOver = true;
            renderHands();
            
            const playerScore = calculateScore(playerHand);
            const dealerScore = calculateScore(dealerHand);
            const messageDiv = document.getElementById('message');
            
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
            
            if (playerScore > 21) {
                messageDiv.textContent = '💥 BUST! You Lose! 💥';
                messageDiv.className = 'message lose';
                document.body.style.animation = 'bodyShake 0.5s ease-in-out';
                setTimeout(() => {
                    document.body.style.animation = '';
                }, 500);
                playSound('lose');
                scores.losses++;
                scores.currentStreak = 0;
            } else if (dealerScore > 21) {
                messageDiv.textContent = '🎉 Dealer Bust! You WIN! 🎉';
                messageDiv.className = 'message win';
                createConfetti();
                playSound('win');
                scores.wins++;
                scores.currentStreak++;
                if (scores.currentStreak > scores.bestStreak) {
                    scores.bestStreak = scores.currentStreak;
                }
            } else if (playerScore > dealerScore) {
                messageDiv.textContent = '🏆 You WIN! 🏆';
                messageDiv.className = 'message win';
                createConfetti();
                playSound('win');
                scores.wins++;
                scores.currentStreak++;
                if (scores.currentStreak > scores.bestStreak) {
                    scores.bestStreak = scores.currentStreak;
                }
            } else if (dealerScore > playerScore) {
                messageDiv.textContent = '😭 You Lose! 😭';
                messageDiv.className = 'message lose';
                playSound('lose');
                scores.losses++;
                scores.currentStreak = 0;
            } else {
                messageDiv.textContent = '🤝 Push! It\'s a Tie! 🤝';
                messageDiv.className = 'message push';
                scores.pushes++;
            }
            
            updateScoreboard();
        }
        
        function activatePowerUp() {
            if (powerUpActive || gameOver) return;
            
            powerUpActive = true;
            document.getElementById('powerUp').classList.add('hidden');
            playSound('powerUp');
            
            const effects = [
                () => {
                    if (playerHand.length > 2) {
                        playerHand.pop();
                        renderHands();
                        showPowerUpMessage('⚡ Removed your last card!');
                    }
                },
                () => {
                    showPowerUpMessage(`⚡ Dealer's hidden card: ${dealerHand[0].value}${dealerHand[0].suit}`);
                },
                () => {
                    playerHand.push({ suit: '🎰', value: 'L' });
                    renderHands();
                    showPowerUpMessage('⚡ Lucky 7 added!');
                }
            ];
            
            effects[Math.floor(Math.random() * effects.length)]();
            
            setTimeout(() => {
                powerUpActive = false;
            }, 1000);
        }
        
        function newGame() {
            playSound('button');
            createDeck();
            shuffleDeck();
            
            playerHand = [deck.pop(), deck.pop()];
            dealerHand = [deck.pop(), deck.pop()];
            gameOver = false;
            
            document.getElementById('hitBtn').disabled = false;
            document.getElementById('standBtn').disabled = false;
            document.getElementById('message').textContent = '';
            document.getElementById('message').className = 'message';
            document.getElementById('powerUp').classList.add('hidden');
            
            renderHands();
            
            if (calculateScore(playerHand) === 21) {
                document.getElementById('message').textContent = '🎯 BLACKJACK! 🎯';
                createConfetti();
                playSound('win');
            }
        }
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'h' || e.key === 'H') hit();
            if (e.key === 's' || e.key === 'S') stand();
            if (e.key === 'n' || e.key === 'N') newGame();
        });
        
        function toggleScoreboard() {
            scoreboardVisible = !scoreboardVisible;
            const scoreboard = document.getElementById('scoreboard');
            const toggle = document.querySelector('.score-toggle');
            
            if (scoreboardVisible) {
                scoreboard.classList.remove('hidden');
                toggle.innerHTML = '✖️';
                toggle.style.background = 'linear-gradient(45deg, #ff006e, #8338ec)';
            } else {
                scoreboard.classList.add('hidden');
                toggle.innerHTML = '📊';
                toggle.style.background = 'linear-gradient(45deg, #ffbe0b, #ff006e)';
            }
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const toggle = document.getElementById('soundToggle');
            
            if (soundEnabled) {
                toggle.innerHTML = '🔊';
                toggle.classList.remove('muted');
                if (!sounds.bgMusic) {
                    sounds.bgMusic = createCircusMusic();
                } else {
                    sounds.bgMusic.gain.gain.value = 0.03;
                    sounds.bgMusic.bassGain.gain.value = 0.02;
                }
            } else {
                toggle.innerHTML = '🔇';
                toggle.classList.add('muted');
                if (sounds.bgMusic) {
                    sounds.bgMusic.gain.gain.value = 0;
                    sounds.bgMusic.bassGain.gain.value = 0;
                }
                if (musicInterval) {
                    clearInterval(musicInterval);
                    musicInterval = null;
                }
                if (sounds.bgMusicNodes.length > 0) {
                    sounds.bgMusicNodes.forEach(node => {
                        try {
                            if (node.stop) node.stop();
                            if (node.disconnect) node.disconnect();
                        } catch (e) {}
                    });
                    sounds.bgMusicNodes = [];
                    sounds.bgMusic = null;
                }
            }
        }
        
        updateScoreboard();
        
        document.addEventListener('click', function initAudio() {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            if (!sounds.bgMusic && soundEnabled) {
                sounds.bgMusic = createCircusMusic();
            }
            document.removeEventListener('click', initAudio);
        }, { once: true });
        
        newGame();
    </script>
</body>
</html>
